var CACHED_TWEETS_URL="http://localhost:8888/cityPulse/tweetlapse/tweets.json",NEW_CACHED_TWEETS_URL="http://localhost:8888/cityPulse/tweetlapse/newestTweets.json",STREAMING_TWEETS_URL="https://stream.twitter.com/1.1/statuses/filter.json?track=STLDW",LIVE_TWEETS_STLDW="http://search.twitter.com/search.json?q=STLDW&rpp=1000&include_entities=true&result_type=recent",LIVE_TWEETS_NEAR_CAM="http://search.twitter.com/search.json?geocode=38.640959,-90.234879,3mi&include_entities=true&result_type=recent",TRACK_TWEETS="http://search.twitter.com/search.json?q=stldw&rpp=1000&include_entities=true&result_type=recent",LIVE_TWEETS_STRANGE_LOOP="http://search.twitter.com/search.json?q=strangeloop&rpp=1000&include_entities=true&result_type=recent",LIVE_TWEETS_CITY_PULSE="http://search.twitter.com/search.json?q=CPSTLDEMO&rpp=1000&include_entities=true&result_type=recent",MAP_WIDTH=1200,MAP_HEIGHT=834,LNG_LEFT=-90.2792,LNG_RIGHT=-90.1903,LAT_BOTTOM=38.618,tweetNum;$(document).ready(function(){function n(e){console.log(e)}function r(e,t){i(e,100,0,t)}function i(t,n,r,s){a(t,s);if(!(r<=n&&t.next_page))return;var o=t.next_page,u="http://search.twitter.com/search.json"+o;r++;$.ajax({url:u,data:e,type:"GET",crossDomain:!0,dataType:"jsonp",success:function(e){i(e,n,r,s)}})}function s(e){o(e,100,0)}function o(t,n,r){u(t);if(!(r<=n&&t.next_page))return;var s=t.next_page,o="http://search.twitter.com/search.json"+s;r++;$.ajax({url:o,data:e,type:"GET",crossDomain:!0,dataType:"jsonp",success:function(e){i(e,n,r)}})}function u(e){var n=e.results,r=n?n.length:0;for(var i=0;i<r;i++){var s=n[i],o='<div class="timelineTweet" id="timelineTweet_'+t+'">';o+='<img class="tweetProfPic" src="'+s.profile_image_url_https+'" alt="profile_picture"/>';o+='<div class="tweetUserInfo"><span class="tweetName">'+s.from_user_name+"</span>";o+='<span class="tweetUserName">@'+s.from_user+"</span></div><hr/>";o+='<div class="tweetText">'+s.text+"</div>";o+='<div class="tweetTime">'+s.created_at+"</div>";o+="</div>";$(o).appendTo("#timeline");t++}}function a(e,t){var n=e.results,r=n?n.length:0;for(var i=0;i<r;i++){var s=n[i];if(s.geo){lat=s.geo.coordinates[0];lng=s.geo.coordinates[1];Math.abs(lat)>0&&Math.abs(lng)>0&&l(s,lat,lng,t)}s&&f(s)}}function f(e){$.ajax({type:"POST",url:"_/php/storeTweets.php",data:e,dataType:"json",error:function(e,t,n){},success:function(e){}})}function l(e,n,r,i){var s=c(n,r,i),o='<div class="tweetBox '+i+'" id="tweetBox_'+t+'" style="position:absolute; width:300px; top:'+s[1]+25+"px; left:"+s[0]+25+'px; display:none;" >';o+='<img class="tweetProfPic" src="'+e.profile_image_url_https+'" alt="profile_picture"/>';o+='<div class="tweetUserInfo"><span class="tweetName">'+e.from_user_name+"</span>";o+='<span class="tweetUserName">@'+e.from_user+"</span></div><hr/>";o+='<div class="tweetText">'+e.text+"</div>";o+="<hr/>";o+='<div class="tweetTime">'+e.created_at+"</div>";o+="</div>";$(o).appendTo("body");t++}function c(e,t,n){var r=LNG_RIGHT-LNG_LEFT,i=LAT_BOTTOM*Math.PI/180,s=(t-LNG_LEFT)*(MAP_WIDTH/r);e=e*Math.PI/180;var o=MAP_WIDTH/r*360/(2*Math.PI),u=o/2*Math.log((1+Math.sin(i))/(1-Math.sin(i))),a=MAP_HEIGHT-(o/2*Math.log((1+Math.sin(e))/(1-Math.sin(e)))-u);if(s>MAP_WIDTH||s<0||a>MAP_WIDTH||a<0)return[0,0];h(s,a,n);return[s,a]}function h(e,n,r){var i=10,s=Math.floor(i/2);n-=s;e-=s;var o='<div class="tweetPoint '+r+'" id="tweetPoint_'+t+'" style="position:absolute; width:'+i+"px; height:"+i+"px; top:"+n+"px; left:"+e+'px; color:white; border-radius:5px;"></div>';$(o).appendTo("body");$("#tweetPoint_"+t).hover(function(){p($(this).attr("id"))},function(){})}function p(e){var t=e.split("_")[1],n=$(".visible").attr("id"),r=n?n.split("_")[1]:"";if(t!==r&&r)$(".visible").delay(250).stop().fadeOut(250,function(){$(this).removeClass("visible");$(".selected").removeClass("selected");$("#tweetPoint_"+t).addClass("selected");$("#tweetBox_"+t).addClass("visible").show()});else{$("#tweetPoint_"+t).addClass("selected");$("#tweetBox_"+t).addClass("visible").show()}}function d(e){var t=e.split("_")[1],n=$(".visible").attr("id"),r=n?n.split("_")[1]:"";t!==r&&$(".visible").stop().delay(250).fadeOut(250,function(){$(this).stop().removeClass("visible");$(".selected").stop().removeClass("selected")})}var e,t=0;c(38.640691,-90.234922,"cam");t++;$.ajax({url:LIVE_TWEETS_NEAR_CAM,data:e,type:"POST",crossDomain:!0,dataType:"jsonp",success:function(e){r(e,"")}});$.ajax({url:LIVE_TWEETS_STRANGE_LOOP,data:e,type:"POST",crossDomain:!0,dataType:"jsonp",success:function(e){r(e,"strangeloop")}});$.ajax({url:LIVE_TWEETS_STLDW,data:e,type:"POST",crossDomain:!0,dataType:"jsonp",success:function(e){r(e,"stldw");s(e)}});$("body").click(function(){$(".visible").stop().delay(250).fadeOut(250,function(){$(this).stop().removeClass("visible");$(".selected").stop().removeClass("selected")})});$("#stldw").toggle(function(){$(this).animate({opacity:.85});$(".stldw").addClass("highlighted");$("#timeline").fadeIn()},function(){$(this).animate({opacity:.25});$(".stldw").removeClass("highlighted");$("#timeline").fadeOut()});$("#strangeloop").toggle(function(){$(this).animate({opacity:.85});$(".strangeloop").addClass("highlighted")},function(){$(this).animate({opacity:.25});$(".strangeloop").removeClass("highlighted")});$("#citypulsedemo").click(function(){$(this).animate({opacity:.85});$.ajax({url:LIVE_TWEETS_CITY_PULSE,data:e,type:"POST",crossDomain:!0,dataType:"jsonp",success:function(e){r(e,"citypulsedemo");s(e)}})})});